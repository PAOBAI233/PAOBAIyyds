2025-12-20 03:27:01 [ERROR]: 数据库连接池初始化失败: This command is not supported in the prepared statement protocol yet {"code":"ER_UNSUPPORTED_PS","errno":1295,"sql":"USE `paobai_restaurant`","sqlState":"HY000","sqlMessage":"This command is not supported in the prepared statement protocol yet","stack":"Error: This command is not supported in the prepared statement protocol yet\n    at PromiseConnection.execute (/www/wwwroot/paobai.cn/node_modules/mysql2/lib/promise/connection.js:47:22)\n    at initPool (/www/wwwroot/paobai.cn/database/init.js:39:22)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async initDatabase (/www/wwwroot/paobai.cn/database/init.js:104:7)\n    at async startServer (/www/wwwroot/paobai.cn/server.js:216:5)"}
2025-12-20 03:29:53 [ERROR]: 数据库连接池初始化失败: This command is not supported in the prepared statement protocol yet {"code":"ER_UNSUPPORTED_PS","errno":1295,"sql":"USE `paobai_restaurant`","sqlState":"HY000","sqlMessage":"This command is not supported in the prepared statement protocol yet","stack":"Error: This command is not supported in the prepared statement protocol yet\n    at PromiseConnection.execute (/www/wwwroot/paobai.cn/node_modules/mysql2/lib/promise/connection.js:47:22)\n    at initPool (/www/wwwroot/paobai.cn/database/init.js:39:22)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async initDatabase (/www/wwwroot/paobai.cn/database/init.js:104:7)\n    at async startServer (/www/wwwroot/paobai.cn/server.js:216:5)"}
2025-12-20 03:36:59 [ERROR]: SQL文件执行失败: /www/wwwroot/paobai.cn/database.sql You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''
    ) as items_detail
FROM orders o
JOIN dining_sessions d ON o.session_id ' at line 1 {"code":"ER_PARSE_ERROR","errno":1064,"sql":"'\r\n    ) as items_detail\r\nFROM orders o\r\nJOIN dining_sessions d ON o.session_id = d.id\r\nJOIN tables t ON o.table_id = t.id\r\nLEFT JOIN order_items oi ON o.id = oi.order_id\r\nLEFT JOIN menu_items mi ON oi.menu_item_id = mi.id\r\nGROUP BY o.id, o.order_no, o.session_id, o.table_id, t.table_number, \r\n         o.total_amount, o.item_count, o.status, o.special_requests, \r\n         o.created_at, d.total_customers, d.leader_nickname","sqlState":"42000","sqlMessage":"You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''\r\n    ) as items_detail\r\nFROM orders o\r\nJOIN dining_sessions d ON o.session_id ' at line 1","stack":"Error: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''\r\n    ) as items_detail\r\nFROM orders o\r\nJOIN dining_sessions d ON o.session_id ' at line 1\n    at PromisePoolConnection.query (/www/wwwroot/paobai.cn/node_modules/mysql2/lib/promise/connection.js:29:22)\n    at executeSqlFile (/www/wwwroot/paobai.cn/database/init.js:81:26)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async initDatabase (/www/wwwroot/paobai.cn/database/init.js:108:7)\n    at async startServer (/www/wwwroot/paobai.cn/server.js:215:5)"}
2025-12-20 03:39:45 [ERROR]: SQL文件执行失败: /www/wwwroot/paobai.cn/database.sql You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''
    ) as items_detail
FROM orders o
JOIN dining_sessions d ON o.session_id ' at line 1 {"code":"ER_PARSE_ERROR","errno":1064,"sql":"'\r\n    ) as items_detail\r\nFROM orders o\r\nJOIN dining_sessions d ON o.session_id = d.id\r\nJOIN tables t ON o.table_id = t.id\r\nLEFT JOIN order_items oi ON o.id = oi.order_id\r\nLEFT JOIN menu_items mi ON oi.menu_item_id = mi.id\r\nGROUP BY o.id, o.order_no, o.session_id, o.table_id, t.table_number, \r\n         o.total_amount, o.item_count, o.status, o.special_requests, \r\n         o.created_at, d.total_customers, d.leader_nickname","sqlState":"42000","sqlMessage":"You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''\r\n    ) as items_detail\r\nFROM orders o\r\nJOIN dining_sessions d ON o.session_id ' at line 1","stack":"Error: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''\r\n    ) as items_detail\r\nFROM orders o\r\nJOIN dining_sessions d ON o.session_id ' at line 1\n    at PromisePoolConnection.query (/www/wwwroot/paobai.cn/node_modules/mysql2/lib/promise/connection.js:29:22)\n    at executeSqlFile (/www/wwwroot/paobai.cn/database/init.js:81:26)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async initDatabase (/www/wwwroot/paobai.cn/database/init.js:108:7)\n    at async startServer (/www/wwwroot/paobai.cn/server.js:215:5)"}
2025-12-20 03:43:42 [ERROR]: 数据库连接池初始化失败: Access denied for user 'paobai_restaurant'@'localhost' (using password: YES) {"code":"ER_ACCESS_DENIED_ERROR","errno":1045,"sqlState":"28000","stack":"Error: Access denied for user 'paobai_restaurant'@'localhost' (using password: YES)\n    at Object.createConnectionPromise [as createConnection] (/www/wwwroot/paobai.cn/node_modules/mysql2/promise.js:19:31)\n    at initPool (/www/wwwroot/paobai.cn/database/init.js:28:36)\n    at initDatabase (/www/wwwroot/paobai.cn/database/init.js:136:13)\n    at startServer (/www/wwwroot/paobai.cn/server.js:215:11)\n    at Object.<anonymous> (/www/wwwroot/paobai.cn/server.js:233:1)\n    at Module._compile (node:internal/modules/cjs/loader:1364:14)\n    at Module._extensions..js (node:internal/modules/cjs/loader:1422:10)\n    at Module.load (node:internal/modules/cjs/loader:1203:32)\n    at Module._load (node:internal/modules/cjs/loader:1019:12)\n    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:128:12)"}
2025-12-20 03:44:18 [ERROR]: 执行SQL语句 3/26 失败 {"sql":"CREATE TABLE restaurants (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    name VARCHAR(100) NOT NULL COMMENT '餐厅名称',\n    logo VARCHAR(255) DEFAULT NULL COMMENT '餐厅Logo图片URL',\n    description TEXT COMMENT ...","error":"Table 'restaurants' already exists"}
2025-12-20 03:47:23 [ERROR]: 执行SQL语句 18/26 失败 {"sql":"INSERT INTO tables (restaurant_id, table_number, table_name, capacity, status) VALUES \n(1, '01', '一号桌', 4, 'available'),\n(1, '02', '二号桌', 4, 'available'),\n(1, '03', '三号桌', 2, 'available'),\n(1, '04', '...","error":"Field 'qr_code' doesn't have a default value"}
2025-12-20 03:48:45 [ERROR]: 执行SQL语句 4/26 失败 {"sql":"CREATE TABLE IF NOT EXISTS tables (\n    id INT PRIMARY KEY AUTO_INCREMENT,\n    restaurant_id INT NOT NULL,\n    table_number VARCHAR(20) NOT NULL COMMENT '桌台号',\n    table_name VARCHAR(50) COMMENT '桌台名称...","error":"You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'CONCAT('https://paobai.cn/order/', table_number) COMMENT '二维码内容',\n    ' at line 7"}
2025-12-20 03:50:19 [ERROR]: 执行SQL语句 19/27 失败 {"sql":"INSERT INTO tables (restaurant_id, table_number, table_name, capacity, status) VALUES \n(1, '01', '一号桌', 4, 'available'),\n(1, '02', '二号桌', 4, 'available'),\n(1, '03', '三号桌', 2, 'available'),\n(1, '04', '...","error":"Field 'qr_code' doesn't have a default value"}
2025-12-20 03:52:17 [ERROR]: 执行SQL语句 4/28 失败 {"sql":"DROP TABLE IF EXISTS tables","error":"Cannot drop table 'tables' referenced by a foreign key constraint 'dining_sessions_ibfk_2' on table 'dining_sessions'."}
2025-12-20 03:53:03 [ERROR]: 执行SQL语句 23/29 失败 {"sql":"CREATE VIEW IF NOT EXISTS order_details AS\nSELECT \n    o.id as order_id,\n    o.order_no,\n    o.session_id,\n    o.table_id,\n    t.table_number,\n    o.total_amount,\n    o.item_count,\n    o.status as ord...","error":"You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'IF NOT EXISTS order_details AS\nSELECT \n    o.id as order_id,\n    o.order_no,\n   ' at line 1"}
2025-12-20 03:55:22 [ERROR]: 执行SQL语句 5/31 失败 {"sql":"ALTER TABLE IF EXISTS tables MODIFY COLUMN qr_code VARCHAR(255) NOT NULL DEFAULT 'https://paobai.cn/order/default' COMMENT '二维码内容'","error":"You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'IF EXISTS tables MODIFY COLUMN qr_code VARCHAR(255) NOT NULL DEFAULT 'https://pa' at line 1"}
2025-12-20 03:57:28 [ERROR]: 执行SQL语句 22/30 失败 {"sql":"CREATE VIEW order_details AS\nSELECT \n    o.id as order_id,\n    o.order_no,\n    o.session_id,\n    o.table_id,\n    t.table_number,\n    o.total_amount,\n    o.item_count,\n    o.status as order_status,\n   ...","error":"You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''' at line 17"}
2025-12-20 03:58:34 [ERROR]: 执行SQL语句 25/29 失败 {"sql":"CREATE INDEX idx_dining_sessions_date ON dining_sessions(DATE(created_at))","error":"You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'created_at))' at line 1"}
2025-12-20 04:17:50 [ERROR]: 数据库连接池初始化失败: This command is not supported in the prepared statement protocol yet {"code":"ER_UNSUPPORTED_PS","errno":1295,"sql":"USE `paobai_restaurant`","sqlState":"HY000","sqlMessage":"This command is not supported in the prepared statement protocol yet","stack":"Error: This command is not supported in the prepared statement protocol yet\n    at PromiseConnection.execute (/www/wwwroot/paobai.cn/node_modules/mysql2/lib/promise/connection.js:47:22)\n    at initPool (/www/wwwroot/paobai.cn/database/init.js:39:22)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)\n    at async query (/www/wwwroot/paobai.cn/database/init.js:152:7)\n    at async /www/wwwroot/paobai.cn/routes/kitchen.js:58:18"}
2025-12-20 04:17:50 [ERROR]: 数据库查询失败: {"sql":"\n    SELECT \n      o.*,\n      t.table_number,\n      t.table_name,\n      ds.leader_nickname,\n      ds.total_customers,\n      TIMESTAMPDIFF(MINUTE, o.created_at, NOW()) as wait_time\n    FROM orders o\n    LEFT JOIN tables t ON o.table_id = t.id\n    LEFT JOIN dining_sessions ds ON o.session_id = ds.id\n    WHERE o.restaurant_id = 1 AND o.status IN (?, ?, ?, ?)\n    ORDER BY \n      CASE \n        WHEN o.priority = 1 THEN 0 \n        ELSE 1 \n      END,\n      o.created_at ASC\n    LIMIT ? OFFSET ?\n  ","params":["pending","confirmed","preparing","ready",50,0],"error":"This command is not supported in the prepared statement protocol yet"}
2025-12-20 04:23:52 [ERROR]: 数据库连接池初始化失败: This command is not supported in the prepared statement protocol yet {"code":"ER_UNSUPPORTED_PS","errno":1295,"sql":"USE `paobai_restaurant`","sqlState":"HY000","sqlMessage":"This command is not supported in the prepared statement protocol yet","stack":"Error: This command is not supported in the prepared statement protocol yet\n    at PromiseConnection.execute (/www/wwwroot/paobai.cn/node_modules/mysql2/lib/promise/connection.js:47:22)\n    at initPool (/www/wwwroot/paobai.cn/database/init.js:39:22)\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)\n    at async query (/www/wwwroot/paobai.cn/database/init.js:152:7)\n    at async /www/wwwroot/paobai.cn/routes/admin.js:591:22"}
2025-12-20 04:23:52 [ERROR]: 数据库查询失败: {"sql":"\n    SELECT \n      COUNT(*) as total_orders,\n      SUM(total_amount) as total_revenue,\n      AVG(total_amount) as avg_order_value,\n      COUNT(CASE WHEN priority = 1 THEN 1 END) as priority_orders\n    FROM orders \n    WHERE restaurant_id = 1 AND status IN (?, ?)\n  ","params":["served","completed"],"error":"This command is not supported in the prepared statement protocol yet"}
2025-12-20 04:25:30 [ERROR]: 执行SQL语句 25/28 失败 {"sql":"CREATE INDEX idx_orders_created_status ON orders(created_at, status)","error":"Duplicate key name 'idx_orders_created_status'"}
